# 人员管理—权限与可见性方案（RBAC + ABAC）

本文定义人员管理的权限与数据可见性统一标准，给出“谁能看什么/能做什么”的最小而完备方案，满足：
- 超级管理员（SuperAdmin）全权；管理员（Admin）由超级管理员授予“权限包”；
- 极敏感数据仅指定人员可见/可导出；
- 部门主管仅能查看部分字段；
- 支持“临时访问授权”（指定人/字段/时长）；
- 当前阶段不启用审计日志；
- 配置尽量通过管理端完成，避免改代码与重发版。

---

## 1. 概念解释：多公司/事业部“硬隔离”与“越权硬边界”

为避免“误读数据边界”带来的合规风险，我们引入两个强边界概念：

- 硬隔离（Hard Isolation）：以“所属公司（Company）/事业部（BU）”为天然边界，越界即默认不可访问。
- 越权硬边界（Hard Authorization Boundary）：即使拥有功能权限（如“查看人员档案”），只要越过边界（访问不属于自己公司/BU的数据），也一律被拒绝，除非获得“显式跨界授权”。

可理解为两层门禁：
1) 你是否有这项能力（功能权限）；
2) 这项能力是否可以作用在“那一片数据”（数据范围权限，受公司/事业部硬边界约束）。

示例：
- 员工甲，属于公司A、BU-X，拥有“人员查看（本部门）”。则：
  - 可查看公司A、BU-X及其下属团队的人；
  - 看不到公司B的任何人，也看不到公司A的BU-Y；
  - 即使拥有“人员查看”能力，也不能跨过公司/BU边界（除非得到跨界授权）。
- HR-管理员乙，属于公司A，拥有“HR敏感资料包（全公司）”。则：
  - 可查看公司A全公司的敏感/极敏感字段；
  - 不能查看公司B的任何信息，除非得到“跨公司授权”。
- 超级管理员：天然拥有所有功能与所有数据范围（可跨公司/事业部）。

配置建议：
- 公司是最高硬边界；当前决定：事业部不作为硬边界（关闭）。BU仅作为数据范围划分标签，可跨BU访问（仍受角色/授权与可见性约束）。

---

## 2. 权限模型：RBAC + ABAC（最小角色 + 属性约束）

角色（RBAC）：
- 超级管理员（SuperAdmin）：拥有任何权限；唯一能授予/回收管理员权限的人。
- 管理员（Admin）：默认无权；通过“权限包”获得具体功能权限与数据范围；不可自我提权。

属性（ABAC）：
- 访问时同时校验：所属公司、事业部、部门层级、是否主管、是否HR、是否在“隐藏名单/限制名单”等。
- 规则优先级：显式拒绝 > 显式允许 > 继承（组织树向下）。

资源与动作（举例）：
- 资源：人员档案、字段配置、资料附件、合同信息、组织架构、审批、导出/报表、权限配置。
- 动作：查看、新增、编辑、删除、配置、导出、审批。

数据范围（Scope）：
- 全公司 / 本事业部 / 本部门（含下属）/ 本人与直属下属 / 指定集合（标签/项目组）。

---

## 3. 系统数据可见性规则

全系统通用的数据可见性规则：
- 隐藏的部门/成员：不可见、不可搜索（全局强约束，最高优先）。
- 限制查看外部门：命中者仅能看本部门（可配置是否含下属团队）。
- 限制查看所有人：命中者只能看自己。
- 字段展示与编辑策略、成员可修改字段：统一由字段级规则控制（见下）。

同一判定逻辑在所有页面与接口复用，保证“所见即合规”。

实现进度（后端落地）：
- 已落库：`Department.leaderUserIds[]`；`UserVisibility{ hidden, viewScope(ALL/SELF_ONLY/DEPT_ONLY) }`；`ViewScope` 枚举；保持“公司”为硬边界（BU不启用硬边界）。
- 已接入：统一可见性判定，查询接口按组织可见性自动过滤（隐藏/仅看自己/本部门+负责人范围）；字段可见性在 `FieldVisibilityService` 叠加校验（目标用户不可见即空集；超级管理员放行；其余结合权限与临时授权）。其中，部门负责人自动放开 INTERNAL 白名单字段：姓名、部门、岗位/职务、工号、在职状态、入职日期、工作邮箱。
- 临时授权：保留 `TemporaryAccessGrant`（人/字段/范围/时效），支持 `scopeDepartmentId` 用于部门范围生效；跨公司访问需授权 `allowCrossBoundary=true` 或超级管理员。
- 下一步：管理端配置页接入（非本阶段）。

---

## 4. 字段分级与可见策略（含部门主管与极敏感数据）

结合《人员信息字段.md》，建议将字段分为四级：
- 公开：姓名、部门、岗位/职务、工作邮箱、座机等“企业内展示”字段。
- 内部：一般个人信息（性别、出生日期、籍贯、住址等）。
- 敏感：合同信息、社保账号、公积金账号、工龄/司龄计算基准等。
- 极敏感：证件信息（证件类型/号码/有效期）、银行卡信息（开户支行/卡号）、资料附件（身份证、银行卡、体检报告、学生证等）。

可见性基线：
- 普通员工：仅可见他人“公开”字段；可见并编辑“自己”的白名单字段（见下）。
- 部门主管：可见本部门（含下属）人员的“公开+部分内部字段”；默认不可见“敏感/极敏感”。
  - 建议的主管白名单（可根据你们需要调整）：姓名、部门、岗位/职务、工号、在职状态、入职日期（可选）、直属上级、工作邮箱。
- 指定HR/被授权人员：可见“敏感/极敏感”字段（见第5节的粒度与导出）。
- 超级管理员：全部可见。

联系方式与假勤信息的明确策略：
- 联系方式：仅“工作邮箱”全员可见；手机号/个人邮箱/微信/QQ默认仅本人可见，对他人需管理员授权；
- 假期余额：仅HR可见；默认禁止下载/导出（如需则在授权矩阵中显式允许）。

成员可自改字段：
- 允许：姓名、别名、头像、手机、性别、座机、地址、邮箱、对外职务、视频号、我的业务、直属上级（是否开放由配置决定）。
- 其余字段：需管理员/HR处理或走审批（如启用）。

---

## 5. 极敏感数据：按“人/字段/范围”三维授权，导出同规

你的要求：极敏感数据仅“特定权限的人（指定HR或由超级管理员指定的人员）”可见与可导出，且最好按颗粒度设定权限。落地如下：

- 授权对象（Who）：用户/用户组（如“HR-薪酬组”）。
- 授权内容（What）：字段级到“极敏感字段集合”的子集（可至单字段）与资料附件类型（如身份证/银行卡/体检报告等）。
- 数据范围（Where）：全公司 / 本事业部 / 本部门 / 指定标签或集合。
- 访问方式（How）：仅查看、查看+下载、查看+下载+导出（分别可配置）。
- 时效（When）：长期有效或与“临时访问授权”结合（见第6节）。

导出规则：
- 与查看同一套授权矩阵；只有具备“导出”能力且被授予相应字段/范围者，方可导出。
- 支持“字段级导出控制”（仅导出被授权字段），默认对敏感/极敏感字段脱敏导出，除非显式允许原文导出。
- 可配置导出次数/时长限制（与第6节类似）。

---

## 6. 临时访问授权（指定人/字段/时长）

满足“临时放行”的业务：
- 授权粒度：指定人员（被授权人）、指定字段集合（可到单字段/附件类型）、指定数据范围（如仅本部门/某项目组）、指定动作（查看/下载/导出）。
- 时效控制：开始时间、结束时间；超时自动失效。
- 冲突处理：临时授权优先于默认拒绝，但不突破“隐藏名单”；若与硬隔离冲突，需在授权中显式标记“允许跨公司/BU”。
- 审计：当前阶段不强制记录审计日志；系统仅保留最小化的授权记录用于判定生效与过期。

### 6.1 临时访问授权模板（示例）

| 被授权人/组 | 字段/附件 | 范围 | 动作 | 时效 | 允许跨公司/BU |
|---|---|---|---|---|---|
| HR-数据专员（临时） | 身份证、学历证书（附件） | 入职办理中（标签） | 查看/下载（带水印） | 7天 | 否 |
| 部门负责人（临时） | 联系方式（手机号） | 本部门 | 查看 | 24小时 | 否 |
| 特批用户A | 合同字段（编号/起止） | 本事业部 | 查看/导出（脱敏） | 30天 | 否 |

---

## 7. 配置与实现建议（不改代码/不重发版为目标）

配置中心（存数据库 + 管理端UI）：
- 角色与权限包：可增删改；权限包内含“资源-动作-范围”矩阵。
- 可见性规则：隐藏部门/成员、限制外部门、限制所有人。
- 字段分级与字段集：公开/内部/敏感/极敏感；主管可见字段白名单；成员可自改白名单。
- 极敏感授权：人/组 × 字段/附件 × 范围 × 动作 × 时效。
- 临时访问授权：与上类似，但带明确起止时间与可选跨边界标记。

统一判定接口（后端实现建议）：
- canAccess(user, action, resource, target, field?) → boolean
  - 同时校验：硬隔离边界 → 隐藏/限制规则 → 角色权限 → 字段分级/白名单 → 极敏感授权/临时授权 → 结果。
- 前端只负责“展示层防护”（根据后端返回的字段可见清单渲染、对不可见字段隐藏/脱敏）。

注意：涉及人员/部门/权限的数据库结构设计与迁移前，会与业务方逐项确认后再落地。

## 7.1 权限包与范围矩阵（模板）

| 权限包 | 资源 | 动作 | 数据范围 | 默认角色（示例） | 备注 |
|---|---|---|---|---|---|
| 人员资料管理包 | user | read/create/update | 全公司/事业部/部门（可选） | admin | 不含极敏感字段 |
| HR敏感资料包 | user_sensitive | read | 全公司 | hr_manager | 可选含导出（脱敏/原文） |
| 组织可见性配置包 | org_visibility | configure | 全公司 | admin | 维护隐藏/限制、自改白名单 |
| 导出与报表包 | export | generate | 指定范围 | admin | 对敏感/极敏感默认脱敏 |

---

## 8. 字段分级基准建议（映射《人员信息字段.md》）

- 公开：姓名、部门、职务/岗位、工作邮箱、座机、对外资料显示项。
- 内部：个人基础信息（性别、出生日期、籍贯、现居地址、政治面貌、民族等）、教育经历（除证件编号类）。
- 敏感：合同信息（合同编号/公司/类型/起止等）、社保账号、公积金账号、工龄/司龄相关计算字段、部分教育证书信息（学位编号等）。
- 极敏感：
  - 证件信息：证件类型/号码/有效期/到期剩余；
  - 银行卡信息：开户人、开户支行、卡号；
  - 资料附件：身份证、银行卡、户口本、学历/学位证书、离职证明、体检报告、学生证、性格测试等原件影像；
  - 联系方式中涉及强隐私的附件或图片。

备注：实际分级以你们最终确认为准；可在管理端维护映射表，后续无需改代码。

---

## 9. MVP 落地清单

1) 建立字段分级与字段集（含主管白名单、成员可自改白名单）。
2) 启用组织可见性规则（隐藏/限制）并全站复用。
3) 配置角色与权限包（仅超级管理员可授予）。
4) 上线“极敏感授权矩阵”（人/组×字段/范围×动作）。
5) 上线“临时访问授权”（含时效/跨边界可选）。
6) 提供“以某用户视角预览权限”的校验页，辅助验收与培训。

---

## 10. 你的确认点（按你的反馈已对齐）

- 多公司/事业部硬隔离与越权硬边界：已解释，默认公司为硬边界，事业部是否作为硬边界可配置。
- 极敏感数据：仅特定HR或由超级管理员指定人员可见/可导出，且按字段粒度授权；导出遵循同一矩阵。
- 部门主管：仅能查看部分字段（公开+部分内部），不含敏感/极敏感。
- 临时访问授权：支持指定人、字段、范围、时长；到期自动失效；不与隐藏名单冲突。
- 审计日志：当前阶段不启用（系统仅保留最小化授权记录用于生效判定）。

如需，我可以基于该方案输出权限配置项清单（CSV/表格），方便直接导入配置中心或作为原型数据。

---

## 进度

- 方案大纲：已确定（RBAC+ABAC、硬边界、字段分级策略）。
- 模板：已补充临时访问授权模板与权限包矩阵模板。
- 后端基建：已实现 AccessControlService（MVP）、权限守卫超管直通、字段分级/字段集落库。
 - 接入情况：用户详情/列表/导出已接入字段可见性；导出接口按敏感/极敏感权限过滤列；临时访问授权（MVP）已接入；公司硬边界已启用（事业部边界关闭）。


